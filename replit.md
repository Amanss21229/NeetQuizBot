# NEET Quiz Bot

## Overview
A comprehensive Telegram bot for NEET students featuring automatic quiz forwarding, real-time scoring, daily leaderboards, and complete admin management. Built using Python with python-telegram-bot v20+ and PostgreSQL database.

## Recent Changes
- 2025-11-11: Added Force Join System
  - New admin commands: /fjoin and /removefjoin
  - Maximum 5 groups/channels can be required for force join
  - Users must join all required groups before using bot features
  - Admins bypass force join requirements completely
  - Polite message with inline buttons to guide users to join
  - Applies to all commands and quiz answering (not just /start)
  - Existing groups can be updated even at 5-group limit
  - Database-backed force join configuration
  - No impact on existing features (quiz forwarding, translation, leaderboards)
- 2025-11-11: Added multilingual quiz support (Hindi/English)
  - New command: /language - Select quiz language preference
  - In groups: Only admins can change language (bot admins or group admins)
  - In private chat: All users can select their preferred language
  - Hindi option: Quizzes automatically translated to Hindi using Google Translate
  - English option: Quizzes remain in original English
  - Translation caching for improved performance and reliability
  - All users share same leaderboard regardless of language
  - Automatic fallback to English if translation fails
  - Database-backed language preference per group
- 2025-11-03: Enhanced group leaderboard with universal ranks
  - Shows each user's global rank across all groups
  - Premium decorated design with colorful emojis and clear layout
  - Performance badges (MASTER, EXPERT, PRO, RISING, BEGINNER)
  - Accuracy indicators with visual icons
  - Special borders for top 3 performers
  - Easy-to-read format with organized stats
  - Compatible with Neon PostgreSQL database
- 2025-11-03: Added user-admin messaging system
  - Users can send messages to bot in private chat, automatically forwarded to admin group (-1003049872361)
  - Admins can reply to user messages directly from admin group
  - Supports all message types: text, images, videos, documents, audio, voice, stickers, GIFs, PDFs
  - User details (name, username, ID) shown in admin group
  - Database-backed message mapping for reliability
  - Commands are not forwarded to avoid spam
- 2025-10-12: Added reply toggle system for groups
  - New commands: /replyoff and /replyon (admin/group admin only)
  - Groups can disable/enable quiz reply messages independently
  - Quiz scoring continues to work even when replies are disabled
  - Admin permission check for both bot admins and group admins
  - Database migration added for existing installations
- 2025-10-12: Added custom reply management system
  - New admin commands: /addpositivereply, /addnegativereply, /removereply
  - Support for text and media replies (photos, videos, documents, stickers, audio, voice, GIFs)
  - Custom replies integrated with existing hardcoded messages
- 2025-09-12: Initial bot implementation with all core features
- Database models created with proper schema for users, groups, quizzes, scores, and admins
- Main bot file with complete functionality including start commands, quiz handling, scoring system, and daily leaderboards
- All admin commands implemented: /broadcast, /stats, /promote, /remove, /adminlist
- User commands implemented: /refresh, /donate, /developer with proper formatting

## Project Architecture
```
├── main.py          # Main bot application with all handlers and logic
├── models.py        # Database models and operations using asyncpg
├── requirements.txt # Auto-generated by uv package manager
└── replit.md       # Project documentation
```

## Features Implemented
### Core Functionality
- ✅ Start message with 3 inline buttons (Add to Group, Meet Owner, Join Community)
- ✅ Automatic quiz forwarding from admin group (-1002848830142) to all bot groups
- ✅ Answer checking system with points (+4 correct, -1 wrong, 0 unattempted)
- ✅ Decorated congratulatory and meme-style failure messages with user tagging
- ✅ Daily automated leaderboards at 10:00 PM IST (Group and Universal top 50)

### Admin Commands
- ✅ /broadcast - Forward replied message to all groups and users
- ✅ /stats - Show bot statistics (users, groups, quizzes, answers)
- ✅ /promote - Promote user as bot admin
- ✅ /remove - Remove user from bot admin list
- ✅ /adminlist - Show all current bot admins
- ✅ /replyoff - Disable quiz reply messages in a group (bot admin/group admin only)
- ✅ /replyon - Enable quiz reply messages in a group (bot admin/group admin only)
- ✅ /language - Set quiz language to Hindi or English (admin-only in groups, everyone in private)
- ✅ /fjoin - Add groups/channels to force join list (max 5, reply to forwarded message)
- ✅ /removefjoin - Remove group/channel from force join list (reply to forwarded message)

### User Commands
- ✅ /refresh - Reboot/refresh the bot
- ✅ /donate - Donate via Telegram Stars
- ✅ /developer - Meet the developer with inline button
- ✅ /language - Select preferred quiz language (available in private chats)

### Database Schema
- **users**: User profiles with scoring statistics
- **groups**: Active bot groups (with reply toggle and language preference support)
- **admins**: Bot administrators
- **quizzes**: Quiz questions and metadata
- **user_quiz_scores**: Individual quiz responses and scores
- **group_members**: Group membership tracking
- **custom_replies**: Custom text and media replies
- **quiz_solutions**: Quiz solutions storage
- **message_mapping**: User-admin message forwarding mappings
- **force_join_groups**: Required groups/channels for force join (max 5)

## Configuration
- Bot Token: **REQUIRED** - Add your bot token from @BotFather as `BOT_TOKEN` secret
- Admin Group ID: -1002848830142
- Target Channels: @thegodoftgbot, t.me/DrQuizBotUpdates
- Timezone: Asia/Kolkata (IST)
- Default Admin: 6195713937 (thegodoftgbot)

### Setup Instructions
1. **Create Telegram Bot**: Message @BotFather on Telegram and create a new bot
2. **Get Bot Token**: Copy the token provided by @BotFather
3. **Add Secret**: In Replit, add the token as a secret named `BOT_TOKEN`
4. **Run the Bot**: The workflow will automatically start the bot

### Required Environment Variables
- `BOT_TOKEN`: Your Telegram bot token from @BotFather
- `DATABASE_URL`: PostgreSQL database connection (automatically configured by Replit)
- `PGPORT`, `PGUSER`, `PGPASSWORD`, `PGDATABASE`, `PGHOST`: Database connection details (automatically configured)

## Technical Stack
- **Language**: Python 3.11
- **Bot Framework**: python-telegram-bot v22.3
- **Database**: PostgreSQL (via Replit integration)
- **Database Driver**: asyncpg
- **Timezone**: pytz
- **Scheduling**: asyncio-based scheduler for daily leaderboards
- **Translation**: deep-translator (Google Translate backend) for Hindi quiz translation

## User Preferences
- 100% automatic operation (no manual setup required monthly/yearly)
- Multi-group support with efficient handling
- Real-time quiz forwarding and scoring
- Decorated messages with emojis and user tagging
- Daily automated leaderboard posting at 10:00 PM IST

## Deployment Notes
- Bot runs continuously with asyncio event loop
- Database connection pooling for efficient operations
- Background scheduler for daily leaderboard posting
- Error handling and logging throughout the application
- All environment variables properly configured via Replit integrations
